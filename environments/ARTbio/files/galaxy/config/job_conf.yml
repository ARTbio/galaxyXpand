# This file is managed by Ansible.
# Do not edit this file manually. Any changes will be automatically reverted.

runners:
  local_runner:
    load: galaxy.jobs.runners.local:LocalJobRunner
    workers: 8
  slurm:
    load: galaxy.jobs.runners.slurm:SlurmJobRunner
    drmaa_library_path: /usr/lib/slurm-drmaa/lib/libdrmaa.so

handling:
  assign:
    - db-skip-locked
  processes:
    handler0:
    handler1:
    handler2:
    handler3:

# artbio has 72 CPUs
execution:
  default: cluster_1
  environments:
    local_env:
      runner: local_runner
      tmp_dir: true
    gce_multicore:
      runner: local_runner
      local_slots: 2
      embed_metadata_in_job: true
    cluster_1:
      runner: slurm
      nativeSpecification: "--partition=debug --ntasks=1"
    cluster_2:
      runner: slurm
      nativeSpecification: "--partition=debug --ntasks=2"
    cluster_4:
      runner: slurm
      nativeSpecification: "--partition=debug --ntasks=4"
    cluster_8:
      runner: slurm
      nativeSpecification: "--partition=debug --ntasks=8"
    cluster_16:
      runner: slurm
      nativeSpecification: "--partition=debug --ntasks=16"
    cluster_64:
      runner: slurm
      nativeSpecification: "--partition=debug --ntasks=64"
    samtools_fastx:
      runner: slurm
      nativeSpecification: "--partition=debug --ntasks=5"
    java_cluster:
      runner: slurm # if not working, try drmaa runner
      nativeSpecification: "--partition=debug --ntasks=1"
      env:
        - name: '_JAVA_OPTIONS'
          value: '-Xmx40g -Xms512m'
        - file: '/home/galaxy/galaxy/.venv/bin/activate'

limits:
  - type: anonymous_user_concurrent_jobs
    value: 1
  - type: registered_user_concurrent_jobs
    value: 64

  - type: environment_total_concurrent_jobs
    id: cluster_1
    value: 60
  - type: environment_total_concurrent_jobs
    id: cluster_2
    value: 30
  - type: environment_total_concurrent_jobs
    id: cluster_4
    value: 15
  - type: environment_total_concurrent_jobs
    id: cluster_8
    value: 8
  - type: environment_total_concurrent_jobs
    id: cluster_16
    value: 4
  - type: environment_total_concurrent_jobs
    id: java_cluster
    value: 32
  - type: environment_total_concurrent_jobs
    id: samtools_fastx
    value: 30

tools:
  - class: local # these special tools that aren't parameterized for remote execution - expression tools, upload, etc
    environment: local_env

  - id: "artbio_bam_cleaning"
    destination: "cluster_8"

  - id: "bcftools_annotate"
    destination: "cluster_8" 

  - id: "bcftools_mpileup"
    destination: "cluster_8" 

  - id: "bcftools_norm"
    destination: "cluster_1" 

  - id: "bowtie_wrapper"
    destination: "cluster_16"

  - id: "bowtie"
    destination: "cluster_16"

  - id: "bowtie2"
    destination: "cluster_16"

  - id: "bowtieForSmallRNA"
    destination: "cluster_16"

  - id: "bwa_mem"
    destination: "cluster_16"

  - id: "bwa_wrappers"
    destination: "cluster_16"

  - id: "bwa"
    destination: "cluster_16"

  - id: "cuffdiff"
    destination: "cluster_16"

  - id: "cutadapt"
    destination: "cluster_16" 

  - id: "deeptools_bam_compare"
    destination: "cluster_16"

  - id: "deeptools_bam_coverage"
    destination: "cluster_16"

  - id: "deeptools_compute_matrix"
    destination: "cluster_16"

  - id: "deeptools_multi_bam_summary"
    destination: "cluster_16"

  - id: "deeptools_plot_correlation"
    destination: "cluster_16"

  - id: "deeptools_plot_coverage"
    destination: "cluster_8"

  - id: "deeptools_plot_fingerprint"
    destination: "cluster_16"

  - id: "dexseq_count"
    destination: "cluster_2"

  - id: "dexseq"
    destination: "cluster_2"

  - id: "fastqc"
    destination: "java_cluster"

  - id: "fastq_dump"
    destination: "cluster_2" 

  - id: "featurecounts"
    destination: "cluster_4" 

  - id: "freebayes"
    destination: "cluster_1" 

  - id: "Group"
    destination: "cluster_1" 

  - id: "guppy-basecaller"
    destination: "cluster_8"

  - id: "hisat2_index_builder_data_manager"
    destination: "cluster_4"

  - id: "hisat2"
    destination: "cluster_16"

  - id: "justgzip"
    destination: "cluster_8" 

  - id: "kallisto_quant"
    destination: "cluster_8"

  - id: "lumpy_smoove"
    destination: "lumpy_smoove" 

  - id: "lumpy_sv"
    destination: "cluster_8"

  - id: "macs2_callpeak"
    destination: "cluster_16"

  - id: "manta"
    destination: "cluster_8"

  - id: "minimap2"
    destination: "cluster_8"

  - id: "mircounts"
    destination: "cluster_8"

  - id: "nanopolish_eventalign"
    destination: "cluster_16"

  - id: "ncbi_blastn_wrapper"
    destination: "cluster_16"

  - id: "ncbi_blastp_wrapper"
    destination: "cluster_16"

  - id: "ncbi_blastx_wrapper"
    destination: "cluster_16"

  - id: "ngsplot"
    destination: "cluster_8"

  - id: "picard_FilterSamReads"
    destination: "java_cluster" 

  - id: "picard_SamToFastq"
    destination: "cluster_1" 

  - id: "repenrich"
    destination: "cluster_16"

  - id: "rna_star_index_builder_data_manager"
    destination: "cluster_8"

  - id: "rna_star"
    destination: "cluster_8"

  - id: "rna_starsolo"
    destination: "cluster_8"

  - id: "rsembowtie"
    destination: "cluster_8"

  - id: "rsembowtie2"
    destination: "cluster_16"

  - id: "sambamba_sample_or_filter"
    destination: "cluster_8"

  - id: "samtool_filter2"
    destination: "cluster_4"

  - id: "samtools_cram_to_bam"
    destination: "cluster_8"

  - id: "samtools_fastx"
    destination: "samtools_fastx"

  - id: "samtools_rmdup"
    destination: "cluster_8"

  - id: "samtools_slice_bam"
    destination: "cluster_8"

  - id: "samtools_view"
    destination: "cluster_8"

  - id: "small_rna_maps"
    destination: "cluster_2"

  - id: "snpEff"
    destination: "java_cluster"

  - id: "snpSift_annotate"
    destination: "java_cluster"

  - id: "snpSift_filter"
    destination: "java_cluster"

  - id: "sr_bowtie_dataset_annotation"
    destination: "cluster_16"

  - id: "table_annovar"
    destination: "cluster_8"

  - id: "tarfast5"
    destination: "cluster_8"

  - id: "tophat2"
    destination: "cluster_16"

  - id: "tp_grep_tool"
    destination: "cluster_1" 

  - id: "vsearch_clustering"
    destination: "cluster_64"

  - id: "xpore_dataprep"
    destination: "cluster_16"

  - id: "xpore_diffmod"
    destination: "cluster_16"
