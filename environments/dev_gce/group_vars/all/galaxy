---
# optimize 2 cpu VM GCE

# development branch
galaxy_commit_id: release_24.1

galaxy_config:
  gravity:
    galaxy_root: /home/galaxy/galaxy
    galaxy_user: galaxy
    gunicorn:
      bind: localhost:4000
      extra_args: --forwarded-allow-ips="*"
      preload: true
      workers: 2         # deux workers web, idéal sur 2 CPU
    handlers:
      job_handlers:
        pools:
          - job-handler
        processes: 1      # un seul handler pour éviter la contention
    celery:
      workers: 1          # un seul worker Celery si utilisé
    process_manager: systemd
    virtualenv: /home/galaxy/galaxy/.venv
  
  galaxy:
    admin_users: admin@example.org,tooladmin@galaxy.org
    database_connection: postgresql:///galaxy?host=/var/run/postgresql
    job_working_directory: /home/galaxy/galaxy/database/jobs
    file_path: datasets
    enable_per_request_sql_debugging: false
    enable_quotas: false
    static_enabled: false
    allow_user_dataset_purge: true
    allow_user_deletion: true
    allow_user_impersonation: true
    cleanup_job: onsuccess
    expose_dataset_path: true
    expose_potentially_sensitive_job_metrics: true
    job_config:
      assign:
        strategy: db-skip-locked

# deploy galaxy configuration files
galaxy_config_templates:
  - src: environments/dev_gce/templates/galaxyXpand_welcome.html.j2
    dest: "{{ galaxy_server_dir }}/static/galaxy_welcome.html"

# deploy png galaxyXpand logo
galaxy_config_files:
  - src: environments/dev_gce/files/job_conf.yml
    dest: "{{ galaxy_config.galaxy.job_config_file }}"
  - src: environments/dev_gce/files/galaxyXpand_logo.png
    dest: "{{ galaxy_server_dir }}/static/images/galaxyXpand_logo.png" 

